<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta content="summary" name="twitter:card">
        <meta content="http://perlnews.ru/blog/2015/02/16/01-extended-regex-modifiers.html" name="twitter:url">
        <meta content="Обсуждение на p5p: флаги регулярных выражений" name="twitter:title">
        <meta content="На прошлой неделе в рассылке perl5-porters была затронута тема флагов регулярных выражений. В Perl 5.14 появился флаг /a, который ограничивал поиск совпадений для \d, \s и \w символами ASCII, а уд…" name="twitter:description">
        <meta content="@perlnews_ru" name="twitter:site">
        <link href="/theme/images/favicon.ico" rel="icon">
        <link href="/theme/css/style.css" rel="stylesheet">
        <title>
            PerlNews.Ru
            → Обсуждение на p5p: флаги регулярных выражений
        </title>
        <script>
  if (window.location.hostname === "perlnews.ru") {
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-59283423-1', 'auto');
      ga('send', 'pageview');
  }
</script>

    </head>
    <body>
        <header>
            <nav class="navbar">
                <div class="container">
                    <a class="brand" href="/">
                        PerlNews.Ru
                        <span class="brand-img"></span>
                    </a>
                    <ul>
                        <li>
                        <a href="/index.html">
                            Новости
                        </a>
                        </li>
                        <li>
                        <a href="/about.html">
                            О блоге
                        </a>
                        </li>
                        <li>
                        <a href="/resources.html">
                            Ресурсы
                        </a>
                        </li>
                        <li>
                        <a href="http://irc.pragmaticperl.com">
                            Чат
                            <span class="typcn typcn-export"></span>
                        </a>
                        </li>
                        <li>
                        <a href="https://twitter.com/perlnews_ru">
                            Twitter
                            <span class="typcn typcn-export"></span>
                        </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
        </header>
        <div class="main container">
            <div class="row">

    <div class="nine columns">
        <main>
            <header>
                <h1>Обсуждение на p5p: флаги регулярных выражений</h1>
                <p class="tags">Темы:
                    <a href="/blog/tag/regexp/" rel="tag">regexp</a>
                </p>
                <aside>
                    <p><time datetime="2015-02-16">
                        <span class="typcn typcn-time"><span>
                        2015-02-16
                    </span></span></time>
                        <span class="typcn typcn-user"><span>
                        perlnews
                    </span></span></p>
                </aside>
            </header>
            <section id="section-1">
                <p>На прошлой неделе в рассылке perl5-porters была затронута тема флагов
регулярных выражений. В Perl 5.14 появился флаг <code>/a</code>, который ограничивал поиск
совпадений для <code>\d</code>, <code>\s</code> и <code>\w</code> символами ASCII, а удвоенный флаг <code>/aa</code>
усиливал эффект и исключал поиск совпадений между ASCII и не-ASCII символами
(например, <code>k</code> перестаёт совпадать с <code>\N{KELVIN SIGN}</code>).</p>

<p><a href="http://xkcd.com/1171/"><img alt="regexp" src="/i/2015-02-16-perl_problems.png"></a></p>

<p>Карл Уильямсон предложил признать устаревшим возможность указывать такие флаги
в перемешку с другими флагами, например, вместо <code>/aa</code> писать <code>/ama</code>. Также
предложено запретить возможность множественного использования флага <code>/i</code>, чтобы
в будущем появилась возможность задавать <code>/ii</code> как вариант для задания более
простого варианта поиска без учёта регистра (без учёта фолдинга). Это должно
улучшить читаемость регулярных выражений. Но...</p>

            </section>
            <section id="section-2">
                <p>Но тут же отметили, что это противоречит примеру использованию <code>/ee</code>, который
допускает смешивание. Кроме того, флаги, которые не имеют особых действий,
могут указываться любое число раз (например, <code>/egg</code>, что даёт возможность
строить забавные слова из флагов, но не несёт практического смысла). Правила
должны быть либо строгими для всех, либо допускать свободное использование.</p>

<p>Было высказано предложение создать либо новое предупреждение, либо опцию к
движку регулярных выражений, которая бы предупреждала о бесполезных флагах в
регулярных выражениях. Но возможно стоит пойти по пути создания какого-то
объектного/функционального интерфейса к регулярным выражениям.</p>

<p>Yves Orton показал такой пример:</p>

<pre><code>match( /PATTERN/, case_insensitive  =&gt; 1, extended_mode =&gt; 1,
    dot_matches_newline =&gt; 1, multiline =&gt; 1);
</code></pre>

<p>Где опции <code>/ixs</code> описываются человеко-понятными терминами.
Вариант для поиска с заменой мог бы выглядеть так:</p>

<pre><code>search_and_replace(/PATTERN/, &quot;REPLACEMENTS&quot;, global =&gt; 1, eval =&gt; 1,
    extended_eval =&gt;1);
</code></pre>

<p>В данном случае составной флаг <code>/ee</code> описывается двумя разными ключами.</p>

<p>Brad Gilbert продолжил конкурс забавных интерфейсов. По аналогии с интерфейсом
Perl 6:</p>

<pre><code>s:global:ignorecase/PATTERN/{ EVAL &quot;REPLACEMENTS&quot; }/;
s:g(True):ignorecase(True)/PATTERN/{ EVAL &quot;REPLACEMENTS&quot; }/;
</code></pre>

<p>Но сделать для Perl5 наоборот:</p>

<pre><code>s/PATTERN/&quot;REPLACEMENTS&quot;/ :eval(2) :extended :ignorecase ;
s/PATTERN/&quot;REPLACEMENTS&quot;/ :e(2) :x :i ;
s/PATTERN/&quot;REPLACEMENTS&quot;/ :eval :eval :x :i(1) ;
</code></pre>

<p>Правда в этом случае возникает сложность с парсингом тернарного оператора,
например:</p>

<pre><code>$bool ? s/PATTERN/&quot;REPLACEMENTS&quot;/ :eval(2);
</code></pre>

<p>Рикардо Сигнес развил эту идею дальше, включив флаги в фигурные скобки:</p>

<pre><code>$x =~ s{foo}{bar}{ :eval(2) :extended :ignorecase };
$z =~ m/baz/{ :nocapture };
</code></pre>

<p>Father Chrysostomos показал вариант объектного решения:</p>

<pre><code>qr/foo/-&gt;match(...)
qr/bar/-&gt;subst(...)
qr/baz/-&gt;(...)  # тоже самое, что и match
</code></pre>

<p>Рикардо Сигнес добавил к нему вариант с заданием флагов:</p>

<pre><code>state  $regex = qr/baz/-&gt;flags(qw(i nocapture));
return $regex-&gt;( $input );
</code></pre>

<p>Правда вариант с вызовом метода очень не понравился Yves Orton. Он указал на
то, что <code>qr//</code> создаёт готовый скомпилированный объект класса <code>Regexp</code>, а вызов
метода <code>flags</code> изменяет опции конструктора объекта. Кроме того вызов
<code>$regex-&gt;($input)</code> противоречит логике, т.к. <code>$regex</code> это не ссылка на код, а
объект (что впрочем легко решается через <code>use overload &#39;&amp;{}&#39;</code>). Взамен он
предлагает ещё один вариант указания флагов, внутри регулярного выражения:</p>

<pre><code>qr/(+case-sensitive, no-capture)baz/
qr/(+no-case-sensitive, no-capture)baz/
</code></pre>

<p>Весь тред можно посмотреть
<a href="http://www.nntp.perl.org/group/perl.perl5.porters/2015/02/msg225807.html">здесь</a>.
А какой вариант понравился вам?</p>

            </section>
        </main>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'perlnewsru';
            if (window.location.hostname === "perlnews.ru") {
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    <div class="three columns sidebar">
        
        <nav id="tags">
            <h1>Темы</h1>
            <ul class="list-inline">
                <li><a href="/blog/tag/aprilfd/">AprilFD</a></li>
                <li><a href="/blog/tag/benchmark/">benchmark</a></li>
                <li><a href="/blog/tag/books/">books</a></li>
                <li><a href="/blog/tag/bug/">bug</a></li>
                <li><a href="/blog/tag/community/">community</a></li>
                <li><a href="/blog/tag/coro/">Coro</a></li>
                <li><a href="/blog/tag/cpan/">CPAN</a></li>
                <li><a href="/blog/tag/cpanpr/">cpanpr</a></li>
                <li><a href="/blog/tag/cpantesters/">cpantesters</a></li>
                <li><a href="/blog/tag/dbic/">DBIC</a></li>
                <li><a href="/blog/tag/donation/">donation</a></li>
                <li><a href="/blog/tag/facepalm/">facepalm</a></li>
                <li><a href="/blog/tag/fork/">fork</a></li>
                <li><a href="/blog/tag/fosdem/">FOSDEM</a></li>
                <li><a href="/blog/tag/funding/">funding</a></li>
                <li><a href="/blog/tag/hackaton/">hackaton</a></li>
                <li><a href="/blog/tag/ide/">IDE</a></li>
                <li><a href="/blog/tag/interview/">interview</a></li>
                <li><a href="/blog/tag/mojo/">mojo</a></li>
                <li><a href="/blog/tag/moscow-pm/">moscow.pm</a></li>
                <li><a href="/blog/tag/perl/">Perl</a></li>
                <li><a href="/blog/tag/perl6/">Perl6</a></li>
                <li><a href="/blog/tag/perlnews-ru/">PerlNews.Ru</a></li>
                <li><a href="/blog/tag/pragmaticperl/">PragmaticPerl</a></li>
                <li><a href="/blog/tag/regexp/">regexp</a></li>
                <li><a href="/blog/tag/security/">security</a></li>
                <li><a href="/blog/tag/smartmatch/">smartmatch</a></li>
                <li><a href="/blog/tag/starwars/">StarWars</a></li>
                <li><a href="/blog/tag/tips/">tips</a></li>
                <li><a href="/blog/tag/unicode/">unicode</a></li>
                <li><a href="/blog/tag/warnings/">warnings</a></li>
                <li><a href="/blog/tag/windows/">windows</a></li>
                <li><a href="/blog/tag/yapc/">YAPC</a></li>
            </ul>
        </nav>
    </div>

</div>

        </div>
        <footer>
            <div class="container">
<strong>© perlnews.ru</strong>
<p>
Все материалы доступны в соответствии с лицензией
<a href="http://creativecommons.org/licenses/by/4.0/deed.ru">CC BY 4.0</a>
<br>
Работает на
<a href="http://preaction.me/statocles">Statocles</a>
и
<a href="http://www.perl.org">Perl</a>
</p>
</div>

        </footer>
    </body>
</html>
